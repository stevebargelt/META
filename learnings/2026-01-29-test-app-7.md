# Retrospective: test-app-7 (Recipe Manager)

**Date:** 2026-01-29
**Project:** test-app-7 (Recipe Manager)
**Duration:** ~13 hours total across 3 pipeline runs
**Outcome:** Partial Success (app built, bugs present, pipeline issues identified)

---

## Quick Stats

| Metric | Value |
|--------|-------|
| Pipeline runs | 3 (project, implementation, feature) |
| Total commits | 19 |
| Test files | 455 |
| Project pipeline | 6 steps, ~1.5 hrs |
| Implementation pipeline | 10 steps, ~96 min |
| Feature pipeline | 9 steps, **~11.6 hrs** (too long) |

---

## What We Built

Full-stack recipe manager with Express + SQLite backend and React + TypeScript frontend. Features: recipe CRUD, tags, ingredient search, meal planning calendar, shopping list generation.

**Pipeline runs:**
1. **project.pipeline** â€” Kickoff, PRD, architecture, orchestrator generated next.pipeline
2. **implementation (next.pipeline)** â€” Built the app with parallelism (backend + frontend)
3. **feature.pipeline** â€” Added shopping list feature

---

## What Went Well

### 1. Implementation Pipeline Parallelism Worked
The orchestrator-generated implementation pipeline correctly parallelized backend and frontend work:
- Steps 3 & 4 ran in `build` parallel group
- Build validation step caught issues at merge point
- 96 min total for full app build

### 2. Contract-First Approach
OpenAPI spec created first, both backend and frontend built against it.

### 3. Auto-close Panes
New feature worked as expected â€” reduced tmux clutter during runs.

### 4. --continue Flag
Successfully ran follow-on pipeline with existing handoff context.

---

## What Didn't Work

### 1. Create Recipe Button Bug ðŸ”´ (FIXED)
**Issue:** Create Recipe button doesn't work (server error: `PUT /api/recipes/0`)
**Impact:** Core functionality broken
**Root cause:** Route `/recipes/new` has no `:id` param, so `useParams()` returns `undefined`. Code checked `id === 'new'` which was `undefined === 'new'` â†’ `false`, causing update instead of create.
**Fix:** Changed `const isNew = id === 'new'` to `const isNew = !id`
**Learning:** When a single component handles both create and edit routes, ensure the "is new" check accounts for the route structure (presence/absence of param, not just value)

### 2. Feature Pipeline Appended to Original PRD ðŸ”´
**Issue:** Product-manager agent appended "Feature PRD: Shopping List Generation" to `docs/PRD.md` instead of creating a separate file
**Impact:** Pollutes original PRD, hard to track feature history
**Fix needed:** Update feature.pipeline step 2 prompt:
```
Create docs/PRD-<feature-name>.md for new feature (do NOT modify the main PRD.md)
```

### 3. No Feature Branch ðŸŸ 
**Issue:** Feature work committed directly to main
**Impact:** No isolation for feature development, harder to review
**Fix needed:** Add step 0 to feature.pipeline:
```
Create and switch to feature branch: git checkout -b feature/<feature-name>
```

### 4. Feature Pipeline Missing Parallelism ðŸ”´
**Issue:** All steps sequential despite independent workstreams
**Current flow:**
```
PM â†’ Architect â†’ Tester â†’ Implement â†’ Review â†’ Docs â†’ DoD â†’ Gate
```

**Better flow:**
```
PM â†’ Architect (gate) â†’ [Tester + Backend + Frontend in parallel] â†’ Build Validation â†’ Review â†’ ...
```

**Specific misses:**
- Tester (step 4) and base implement (step 5) could run in parallel
- For full-stack features: backend and frontend could run in parallel
- Need build validation step after parallel merge

### 5. Feature Pipeline Duration: 11.6 hours (wall clock) ðŸŸ 
**Issue:** Reported as 11.6 hours but most was gate wait time (human not present)
**Actual cause:** Human stepped away, gates waited for approval
**Learning:** Need to track execution time vs gate wait time separately
**Fix implemented:** Added gate wait tracking to meta CLI â€” now reports:
- Total duration (wall clock)
- Execution time (total - gate wait)
- Gate wait time

---

## META Framework Changes Needed

### 1. Update feature.pipeline

```
# Current (all sequential)
1 | base            | - | auto | - | 5  | Preflight
2 | product-manager | - | auto | - | 30 | Create PRD
3 | architect       | - | gate | - | -  | Design
4 | tester          | - | auto | - | -  | Test plan
5 | base            | - | auto | - | -  | Implement
6 | reviewer        | - | gate | - | -  | Review
...

# Proposed (with parallelism + feature branch)
1 | base            | - | auto | - | 5  | Create feature branch and preflight
2 | product-manager | - | auto | - | 30 | Create docs/PRD-<feature>.md (separate file)
3 | architect       | - | gate | - | -  | Design feature architecture
4 | tester          | - | auto | dev | - | Create test plan and skeleton tests
5 | base            | - | auto | dev | - | Implement feature (backend)
6 | base            | - | auto | dev | - | Implement feature (frontend)
7 | base            | - | auto | - | 10 | Build validation after parallel merge
8 | reviewer        | - | gate | - | -  | Review
9 | base            | - | auto | - | -  | Fix review feedback
10| documenter      | - | auto | - | -  | Update docs
11| base            | - | auto | - | -  | DoD checklist
12| base            | - | gate | - | -  | Quality gate
```

### 2. PRD File Naming Convention
- Main project PRD: `docs/PRD.md`
- Feature PRDs: `docs/PRD-<feature-name>.md` (e.g., `docs/PRD-shopping-list.md`)

### 3. Feature Branch Workflow
- Feature pipeline creates `feature/<name>` branch at start
- All work happens on feature branch
- PR created at end (or manual merge)

---

## Pipeline Comparison

| Pipeline | Steps | Parallel Groups | Duration | Issues |
|----------|-------|-----------------|----------|--------|
| project | 6 | 0 | ~1.5 hrs | None |
| implementation | 10 | 1 (build) | 96 min | Minor |
| feature | 9 | 0 | 11.6 hrs | Many |

**Key insight:** Implementation pipeline had parallelism and was fast. Feature pipeline had none and was slow.

---

## Action Items

### Immediate (before next test)

- [ ] Fix feature.pipeline to include parallelism
- [ ] Add feature branch creation to feature.pipeline
- [ ] Update product-manager prompt for feature PRDs
- [ ] Add build validation step after parallel merge

### Debug

- [ ] Diagnose Create Recipe button server error in test-app-7

### Documentation

- [ ] Update what-works.md with implementation pipeline success
- [ ] Update what-doesnt.md with feature pipeline issues
- [ ] Document feature branch workflow pattern

---

## Hypothesis for Next Test

**H1:** Updated feature.pipeline with parallelism will reduce feature time by 50%+
**H2:** Separate PRD files will improve feature tracking
**H3:** Feature branches will improve review quality

---

## Notes

- The `--continue` flag worked well for running orchestrator-generated pipelines
- Auto-close panes reduced tmux noise significantly
- Pipeline step numbering fix (1-based) resolved parsing errors
- Orchestrator needed explicit 7-field format reminder to generate valid pipelines
