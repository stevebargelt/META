name: project
description: End-to-end new project kickoff and build orchestration
timeout_min: 90

# NUM | AGENT | CLI | GATE | PARALLEL_GROUP | TIMEOUT_MIN | PROMPT
1 | base            | -           | auto | - | 5  | Preflight check: Run META/scripts/preflight-gate.sh --project . (or parent if not yet bootstrapped). Report any failures in .meta/handoff.md. If blockers exist, stop and explain what needs to be fixed.
2 | base            | interactive | auto | - | 45 | Run kickoff using ../META/prompts/kickoff.md (adjust path if needed). Ask questions in the tmux step window, write AGENTS.md, ensure CLAUDE.md is a symlink, and summarize answers in .meta/handoff.md. Exit the session when done.
3 | product-manager | - | auto | - | 45 | Create docs/PRD.md from kickoff answers in .meta/handoff.md. Update .meta/handoff.md with scope and open questions.
4 | architect       | - | gate | - | 45 | Design architecture from PRD. Create docs/ARCHITECTURE.md with Mermaid diagrams (system overview, key flows, data model). IMPORTANT: Use feature-first folder structure (features/ with vertical slices) not layer-first (components/, services/). See META/patterns/project-structures/feature-first.md. Update .meta/handoff.md with decisions.
5 | base            | interactive | auto | - | 30 | External services setup + info discovery. Read .meta/handoff.md and ARCHITECTURE.md to identify required external services (e.g., Supabase, Auth0, S3). Ask for setup details, create/update .env.example and a setup note in docs/SETUP.md. Use META/prompts/external-service-setup-checklist.md. If none needed, note "no external services" in .meta/handoff.md. Exit when complete.
6 | orchestrator    | - | gate | - | 45 | Generate build pipeline structure. Read PRD and Architecture to identify all platforms and features. Create .meta/next.pipeline with proper sequence: (1) Contract/types, (2) Backend implementation, (3) Build validation, (4) Data layer, (5) Frontend implementation, (6) Tests, (7) DevOps, (8) DoD, (9) Quality gate. Include ALL features and platforms from PRD. Use contract-first approach (OpenAPI stub before parallel work). Include build validation steps. The parallelization-analyzer agent will optimize parallelization in the next step, so focus on correct structure and scope coverage. Update .meta/handoff.md with plan summary and scope verification mapping PRD features to step numbers.
7 | parallelization-analyzer | - | gate | - | 30 | Optimize parallelization in generated pipeline. Read docs/PRD.md (Must-Have features), docs/ARCHITECTURE.md (data model, API design, folder structure), and .meta/next.pipeline. Extract feature list, build dependency graph, validate safety (no shared tables, FK constraints, file conflicts). Rewrite .meta/next.pipeline with fine-grained feature steps assigned to PARALLEL_GROUPs. Independent features get SAME group (web-features, mobile-features, backend-features). Create .meta/parallelization-analysis.md with dependency graph (Mermaid), safety analysis per feature, and time savings estimate. Update .meta/handoff.md with parallelization summary.
8 | base            | -           | gate | - | 10 | DUAL GATE: (1) Parallelization verification: Check .meta/next.pipeline for PARALLEL_GROUP entries. Count parallel groups - must have at least 3 (backend, web-features, mobile-features). If fewer, document why in .meta/handoff.md and request user approval before continuing. (2) Scope verification: Run META/scripts/scope-verification.sh --project . --pipeline .meta/next.pipeline to verify PRD coverage. If gaps found, either fix .meta/next.pipeline or create docs/DEFERRED.md with justifications. Do NOT proceed until BOTH checks pass.
